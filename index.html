<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>HaberCraft Pro — Interaktif Haber Tüketim Platformu</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#0b0f17;          /* ana arka plan */
      --card:#131a26;        /* kart arka planı */
      --muted:#8aa0b7;       /* ikincil metin */
      --text:#eaf2ff;        /* ana metin */
      --acc:#5b9dff;         /* vurgu */
      --acc-2:#8b5bff;       /* vurgu 2 */
      --good:#45d483;        /* iyi */
      --bad:#ff6b6b;        /* kötü */
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --radius: 16px;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;background:radial-gradient(1200px 800px at 80% -10%, rgba(91,157,255,.18), transparent),
                                        radial-gradient(1000px 700px at -20% 110%, rgba(139,91,255,.12), transparent),
                                        var(--bg);
              color:var(--text);font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial}
    a{color:inherit;text-decoration:none}

    /* Layout */
    #app{display:grid; grid-template-rows: 56px 1fr 68px; height:100vh;}
    header{display:flex;align-items:center;justify-content:space-between;padding:0 16px; backdrop-filter:saturate(1.2) blur(6px);
            position:sticky;top:0;z-index:50;border-bottom:1px solid rgba(255,255,255,.06)}
    header .brand{display:flex;align-items:center;gap:10px}
    .pill{padding:6px 10px;border-radius:999px;background:linear-gradient(135deg,var(--acc),var(--acc-2)); box-shadow:var(--shadow); font-weight:700;font-size:12px}

    main{position:relative;overflow:hidden}
    .screen{position:absolute;inset:0;overflow:auto; display:none; padding:16px}
    .screen.active{display:block}

    /* Bottom Nav */
    nav{
      display:grid;grid-template-columns:repeat(4,1fr);gap:6px; align-items:center; padding:10px 8px; border-top:1px solid rgba(255,255,255,.06);
      background: linear-gradient(180deg, rgba(10,14,22,.4), rgba(10,14,22,.9)); position:sticky; bottom:0; z-index:60;
    }
    .nav-btn{display:flex;flex-direction:column;align-items:center;gap:6px;padding:8px;border-radius:14px;color:var(--muted);cursor:pointer;user-select:none}
    .nav-btn.active{background:linear-gradient(180deg, rgba(91,157,255,.12), rgba(139,91,255,.12)); color:var(--text)}
    .nav-btn svg{width:22px;height:22px;}

    /* HOME (Gündem) */
    .chips{display:flex; gap:8px; overflow:auto; padding-bottom:8px}
    .chip{padding:8px 12px;border:1px solid rgba(255,255,255,.12); border-radius:999px; color:var(--muted);white-space:nowrap; cursor:pointer}
    .chip.active{background:linear-gradient(135deg, rgba(91,157,255,.18), rgba(139,91,255,.18)); color:var(--text)}

    .grid{display:grid; grid-template-columns:repeat(auto-fill,minmax(260px,1fr)); gap:14px;}
    .card{background:linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02)); border:1px solid rgba(255,255,255,.06);
          border-radius:var(--radius); box-shadow:var(--shadow); overflow:hidden; display:flex;flex-direction:column}
    .media{position:relative; aspect-ratio:16/9; background:#0e1320; overflow:hidden}
    .media img{width:100%;height:100%;object-fit:cover; filter:saturate(1.1)}
    .badge{position:absolute; inset:auto 10px 10px auto; background:rgba(0,0,0,.55); padding:6px 10px; border-radius:999px; font-size:12px}
    .card .body{padding:12px 14px; display:flex; flex-direction:column; gap:8px}
    .title{font-weight:700; line-height:1.25}
    .muted{color:var(--muted)}
    .btn{display:inline-flex; align-items:center; gap:8px; padding:10px 12px; background:linear-gradient(135deg, rgba(91,157,255,.22), rgba(139,91,255,.22)); border:1px solid rgba(255,255,255,.14);
         border-radius:12px; cursor:pointer; font-weight:600}

    /* REELS Enhanced */
    .reels{height:calc(100vh - 56px - 68px); overflow:auto; scroll-snap-type:y mandatory; position:relative}
    .reel{position:relative; height:100%; min-height:calc(100vh - 56px - 68px); scroll-snap-align:start; display:flex; align-items:center; justify-content:center;}
    .reel video{position:absolute; inset:0; width:100%; height:100%; object-fit:cover; filter:brightness(.85) saturate(1.2)}
    .reel .overlay{position:absolute; inset:auto 0 0 0; padding:16px; display:flex; justify-content:space-between; align-items:flex-end; gap:12px}
    .meta{max-width:70%; background:linear-gradient(180deg, rgba(0,0,0,.0), rgba(0,0,0,.55)); padding:10px 12px; border-radius:12px}
    .actions{display:flex; flex-direction:column; gap:12px; align-items:center}
    .action{width:46px; height:46px; display:grid; place-items:center; background:rgba(0,0,0,.35); border:1px solid rgba(255,255,255,.18); border-radius:12px; cursor:pointer}
    
    /* Yeni Özellikler */
    .title-suggest-btn{position:absolute; top:16px; right:16px; background:rgba(0,0,0,.6); border:1px solid rgba(255,255,255,.2); border-radius:12px; color:white; padding:8px 12px; cursor:pointer; font-size:12px}
    .location-map{position:absolute; top:16px; left:16px; width:200px; height:150px; background:rgba(0,0,0,.7); border:1px solid rgba(255,255,255,.2); border-radius:12px; overflow:hidden}
    .map-placeholder{width:100%; height:100%; background:linear-gradient(45deg, #1a4c3a, #2d5a4a); display:flex; align-items:center; justify-content:center; color:white; font-size:12px; text-align:center}
    .map-marker{position:absolute; width:20px; height:20px; background:#ff4444; border-radius:50%; border:2px solid white; cursor:pointer; transform:translate(-50%, -50%)}
    
    /* Liderlik Tablosu */
    .leaderboard{position:fixed; top:80px; right:20px; width:280px; background:rgba(0,0,0,.85); border:1px solid rgba(255,255,255,.15); border-radius:16px; backdrop-filter:blur(10px); padding:16px; z-index:100; opacity:0; transform:translateX(100px); transition:.3s; pointer-events:none}
    .leaderboard.show{opacity:1; transform:translateX(0); pointer-events:auto}
    .leaderboard h3{margin:0 0 12px; color:var(--acc); font-size:16px; text-align:center}
    .leader-item{display:flex; justify-content:space-between; align-items:center; padding:8px 0; border-bottom:1px solid rgba(255,255,255,.1)}
    .leader-item:last-child{border-bottom:none}
    .leader-rank{color:var(--acc-2); font-weight:bold; width:20px}
    .leader-name{flex:1; margin-left:8px; font-size:14px}
    .leader-score{color:var(--good); font-weight:bold; font-size:12px}
    
    /* Başlık Önerileri Modal */
    .suggestions-modal{position:fixed; inset:0; background:rgba(0,0,0,.7); backdrop-filter:blur(6px); z-index:200; display:none; align-items:center; justify-content:center}
    .suggestions-content{background:linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.04)); border:1px solid rgba(255,255,255,.15); border-radius:16px; width:90%; max-width:500px; padding:20px; color:var(--text)}
    .suggestion-item{display:flex; justify-content:space-between; align-items:center; padding:12px; margin:8px 0; background:rgba(255,255,255,.05); border-radius:8px; border:1px solid rgba(255,255,255,.1)}
    .vote-btn{background:var(--acc); color:white; border:none; border-radius:6px; padding:4px 8px; cursor:pointer; font-size:12px}
    .add-suggestion{margin-top:16px; padding:12px; background:rgba(255,255,255,.05); border-radius:8px}
    .add-suggestion input{width:100%; background:transparent; border:1px solid rgba(255,255,255,.2); border-radius:6px; padding:8px; color:var(--text)}
    
    /* Konum İşaretleme */
    .location-marker-ui{position:absolute; bottom:100px; left:16px; background:rgba(0,0,0,.7); border:1px solid rgba(255,255,255,.2); border-radius:8px; padding:8px; color:white; font-size:12px}
    .accuracy-score{color:var(--good); font-weight:bold}
    
    /* Animasyonlar */
    @keyframes pulse {
      0% { transform:translate(-50%, -50%) scale(1); opacity:1 }
      50% { transform:translate(-50%, -50%) scale(1.1); opacity:0.7 }
      100% { transform:translate(-50%, -50%) scale(1); opacity:1 }
    }
    
    @keyframes slideInRight {
      from { transform:translateX(100px); opacity:0 }
      to { transform:translateX(0); opacity:1 }
    }
    
    .title-option:hover {
      background:rgba(255,255,255,.08) !important;
      transform:translateY(-2px);
      border-color:rgba(255,255,255,.2) !important;
    }
    
    /* Responsive */
    @media(max-width:768px) {
      .location-map { width:150px; height:100px; }
      .leaderboard { width:240px; right:10px; }
      .suggestions-content { width:95%; padding:16px; }
    }

    /* KEŞFET */
    .list{display:flex; flex-direction:column; gap:12px}
    .row{display:grid; grid-template-columns:120px 1fr; gap:12px; align-items:center; background:linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02)); border:1px solid rgba(255,255,255,.06); border-radius:14px; overflow:hidden}
    .row img{width:100%; height:100%; object-fit:cover}

    /* OYUNLAR */
    .games-layout{display:grid; grid-template-columns: 320px 1fr; gap:16px; height:calc(100vh - 56px - 68px);}
    @media(max-width:980px){ .games-layout{grid-template-columns:1fr; grid-auto-rows: auto 1fr} }

    .game-menu{background:linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02)); border:1px solid rgba(255,255,255,.06); border-radius:var(--radius); box-shadow:var(--shadow); padding:12px; overflow:auto}
    .game-item{display:flex; gap:10px; align-items:center; padding:10px; border-radius:12px; cursor:pointer; border:1px solid transparent}
    .game-item:hover{background:rgba(255,255,255,.05); border-color:rgba(255,255,255,.1)}
    .dot{width:12px;height:12px;border-radius:50%; background:linear-gradient(135deg,var(--acc),var(--acc-2))}

    .game-stage{position:relative; background:linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02)); border:1px solid rgba(255,255,255,.06); border-radius:var(--radius); box-shadow:var(--shadow); overflow:hidden}
    .game-toolbar{position:absolute; inset:10px 10px auto 10px; display:flex; gap:10px; align-items:center; z-index:10}
    .toolbar-btn{padding:8px 12px; border-radius:10px; background:rgba(0,0,0,.4); border:1px solid rgba(255,255,255,.15); cursor:pointer}

    .stage-split{display:grid; grid-template-columns: 1fr 360px; height:100%}
    @media(max-width:1100px){ .stage-split{grid-template-columns:1fr} }

    .news-panel{border-left:1px solid rgba(255,255,255,.08); background:rgba(0,0,0,.2); padding:12px; overflow:auto}
    .news-panel h3{margin:6px 0}
    .news-panel .p{color:var(--muted); line-height:1.5}

    /* Canvas surfaces */
    canvas{display:block; width:100%; height:100%; background:radial-gradient(500px 300px at 80% -10%, rgba(91,157,255,.12), transparent), #0c1220}

    .label{font-size:12px; color:var(--muted)}
    .score{font-weight:800}

    /* Utility */
    .row-center{display:flex; align-items:center; gap:10px}
    .hidden{display:none !important}
  </style>
</head>
<body>
  <div id="app">
    <header>
      <div class="brand row-center">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M4 12C4 7.582 7.582 4 12 4s8 3.582 8 8-3.582 8-8 8" stroke="url(#g)" stroke-width="2" stroke-linecap="round"/><defs><linearGradient id="g" x1="4" y1="4" x2="20" y2="20" gradientUnits="userSpaceOnUse"><stop stop-color="#5b9dff"/><stop offset="1" stop-color="#8b5bff"/></linearGradient></defs></svg>
        <strong>HaberCraft Pro</strong>
        <span class="pill">Hackathon 2025</span>
      </div>
      <div class="row-center">
        <span class="label">Puan: <span id="userScore">0</span></span>
        <span class="label">|</span>
        <span class="label">Tema</span>
        <button id="themeToggle" class="toolbar-btn">☾</button>
      </div>
    </header>

    <main>
      <!-- HOME / GÜNDEM -->
      <section id="screen-home" class="screen active">
        <h2 style="margin:8px 0 12px;">Gündem</h2>
        <div class="chips" id="homeChips"></div>
        <div class="grid" id="homeGrid"></div>
      </section>

      <!-- REELS -->
      <section id="screen-reels" class="screen">
        <div class="reels" id="reelsContainer">
          <!-- reels items dynamically injected -->
        </div>
        
        <!-- Liderlik Tablosu -->
        <div class="leaderboard" id="leaderboard">
          <h3>🏆 Liderlik Tablosu</h3>
          <div id="leaderboardContent"></div>
        </div>
        
        <!-- Başlık Önerileri Modal -->
        <div class="suggestions-modal" id="suggestionsModal">
          <div class="suggestions-content">
            <h3>💡 Başlık Önerileri</h3>
            <div id="currentSuggestions"></div>
            <div class="add-suggestion">
              <h4>Yeni Öneri Ekle:</h4>
              <input type="text" id="newSuggestionInput" placeholder="Daha iyi bir başlık öner...">
              <button class="vote-btn" id="submitSuggestion">Öner</button>
            </div>
            <div style="text-align:center; margin-top:16px">
              <button class="toolbar-btn" id="closeSuggestions">Kapat</button>
            </div>
          </div>
        </div>
      </section>

      <!-- KEŞFET -->
      <section id="screen-explore" class="screen">
        <div class="row-center" style="margin-bottom:12px;gap:8px">
          <input id="search" placeholder="Ara: başlık, konu, etiket..." style="flex:1; padding:12px;border-radius:12px;border:1px solid rgba(255,255,255,.12);background:rgba(255,255,255,.04);color:var(--text)"/>
          <button id="clearSearch" class="toolbar-btn">Temizle</button>
        </div>
        <div class="list" id="exploreList"></div>
      </section>

      <!-- OYUNLAR -->
      <section id="screen-games" class="screen">
        <div class="games-layout">
          <aside class="game-menu" id="gameMenu">
            <h3 style="margin:6px 0 12px;">Oyunlar</h3>
            <div class="game-item" data-game="catcher">
              <div class="dot"></div><div>
                <div><strong>Başlık Yakala</strong> <span class="label">(Canvas • Okurken yakala)</span></div>
                <div class="muted" style="font-size:12px">Düşen anahtar kelimeleri topla, gürültüyü bırak.</div>
              </div>
            </div>
            <div class="game-item" data-game="memory">
              <div class="dot"></div><div>
                <div><strong>Haber Eşleştir</strong> <span class="label">(Hafıza)</span></div>
                <div class="muted" style="font-size:12px">Haber kartlarını eşleştir; özetler açığa çıksın.</div>
              </div>
            </div>
            <div class="game-item" data-game="reveal">
              <div class="dot"></div><div>
                <div><strong>Kaydır Aç</strong> <span class="label">(Odak)</span></div>
                <div class="muted" style="font-size:12px">Sürgüyü doğru ritimde kaydır, paragrafı aç.</div>
              </div>
            </div>
          </aside>

          <section class="game-stage">
            <div class="game-toolbar">
              <button class="toolbar-btn" id="btnStart">Başlat</button>
              <div class="label">Skor:</div>
              <div class="score" id="score">0</div>
              <div class="label"> | Süre:</div>
              <div class="score" id="timer">00:00</div>
            </div>

            <div class="stage-split">
              <div id="stageHost"><!-- Canvas or widgets injected here --></div>
              <aside class="news-panel">
                <div class="label">Okurken oku:</div>
                <h3 id="npTitle">—</h3>
                <div id="npBody" class="p">—</div>
              </aside>
            </div>
          </section>
        </div>
      </section>
    </main>

    <nav>
      <div class="nav-btn active" data-nav="home" title="Ana Sayfa">
        <svg viewBox="0 0 24 24" fill="none"><path d="M4 12L12 4l8 8v7a1 1 0 0 1-1 1h-4v-6H9v6H5a1 1 0 0 1-1-1v-7z" stroke="currentColor" stroke-width="1.8" stroke-linejoin="round"/></svg>
        <small>Ana</small>
      </div>
      <div class="nav-btn" data-nav="reels" title="Reels">
        <svg viewBox="0 0 24 24" fill="none"><rect x="3" y="4" width="18" height="16" rx="3" stroke="currentColor" stroke-width="1.8"/><path d="M8 4l3 4M13 4l3 4" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/></svg>
        <small>Reels</small>
      </div>
      <div class="nav-btn" data-nav="explore" title="Keşfet">
        <svg viewBox="0 0 24 24" fill="none"><circle cx="11" cy="11" r="7" stroke="currentColor" stroke-width="1.8"/><path d="M16.5 16.5L21 21" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/></svg>
        <small>Keşfet</small>
      </div>
      <div class="nav-btn" data-nav="games" title="Oyun">
        <svg viewBox="0 0 24 24" fill="none"><rect x="3" y="7" width="18" height="10" rx="4" stroke="currentColor" stroke-width="1.8"/><circle cx="8" cy="12" r="1.6" fill="currentColor"/><circle cx="16" cy="10" r="1.2" fill="currentColor"/><circle cx="18" cy="12.5" r="1.2" fill="currentColor"/></svg>
        <small>Oyun</small>
      </div>
    </nav>
  </div>

  <script>
    // --------- Demo Data ---------
    const NEWS = [
      { id:1, category:"Gündem", title:"Merkez Bankası politika faizini sabit tuttu", img:"https://images.unsplash.com/photo-1526304640581-d334cdbbf45e?q=80&w=1200&auto=format&fit=crop", summary:"Para Politikası Kurulu, enflasyon görünümünü izlerken politika faizinde değişikliğe gitmedi.", content:`<p>Merkez Bankası (TCMB), politika faizini bu ay da sabit tuttu. Kararda, enflasyon görünümündeki iyileşmenin sınırlı kaldığı ve finansal koşulların yakından izlendiği belirtildi.</p><p>Kurul, fiyat istikrarını desteklemek amacıyla likidite yönetiminde esnekliğin korunacağını vurguladı.</p>`,
              keywords:["Merkez Bankası","faiz","enflasyon","TCMB","likidite"], hasLocation: false, location: null,
              alternativeTitles: ["TCMB Faiz Kararını Açıkladı", "Politika Faizi Değişmedi"] },
      { id:2, category:"Teknoloji", title:"Yerli uydudan ilk görüntüler paylaşıldı", img:"https://images.unsplash.com/photo-1451187580459-43490279c0fa?q=80&w=1200&auto=format&fit=crop", summary:"Yörüngedeki ilk ayını tamamlayan yerli gözlem uydusundan yüksek çözünürlüklü görüntüler geldi.", content:`<p>Uydunun optik sistemleri, yerleşim alanları ve tarım sahalarını yüksek netlikte görüntülemeyi başardı. Veri işleme altyapısı yerli yazılımlarla çalışıyor.</p>`, keywords:["uydu","yörünge","optik","görüntü","yerli yazılım"], hasLocation: true, location: {lat: 39.9334, lng: 32.8597, name: "Ankara"},
              alternativeTitles: ["Türk Uydusundan İlk Kareler", "Yörüngedeki Gözümüzden İlk Görüntüler"] },
      { id:3, category:"Spor", title:"Derbide 3-1'lik galibiyet", img:"https://images.unsplash.com/photo-1518091043644-c1d4457512c6?q=80&w=1200&auto=format&fit=crop", summary:"Lider derbide 3-1 kazandı; attığı üç golle taraftarını sevindirdi.", content:`<p>Maçın ilk yarısı dengeli geçerken ikinci yarıda hücum varyasyonları sonuç verdi. Teknik direktör, oyuna sonradan giren oyuncuların katkısına dikkat çekti.</p>`, keywords:["gol","derbi","teknik direktör","taraftar","galibiyet"], hasLocation: true, location: {lat: 41.0082, lng: 28.9784, name: "İstanbul"},
              alternativeTitles: ["Dev Derbide Muhteşem Zafer", "3 Golle Büyük Galibiyete"] },
      { id:4, category:"Dünya", title:"İklim zirvesinde yeni mutabakat", img:"https://images.unsplash.com/photo-1542125679-3d97f9e2cc47?q=80&w=1200&auto=format&fit=crop", summary:"Ülkeler emisyon azaltımı konusunda yeni hedeflerde anlaştı.", content:`<p>Mutabakat, sanayi ve enerji sektörlerinde karbonsuzlaşma adımlarının hızlandırılmasını öngörüyor. Gelişmekte olan ülkeler için finansman araçları genişletiliyor.</p>`, keywords:["emisyon","karbonsuzlaşma","finansman","hedef","zirve"], hasLocation: false, location: null,
              alternativeTitles: ["İklim Anlaşması İmzalandı", "Karbon Emisyonu İçin Yeni Hedefler"] },
      { id:5, category:"Kültür", title:"Klasik müzik festivaline yoğun ilgi", img:"https://images.unsplash.com/photo-1511379938547-c1f69419868d?q=80&w=1200&auto=format&fit=crop", summary:"Açılış konserinde dünyaca ünlü şef sahne aldı.", content:`<p>Programda senfonik eserlerin yanı sıra çağdaş yapıtlar da yer aldı. Festival boyunca genç müzisyenlere atölyeler düzenlenecek.</p>`, keywords:["orkestra","şef","senfoni","festival","atölye"], hasLocation: true, location: {lat: 41.0082, lng: 28.9784, name: "İstanbul"},
              alternativeTitles: ["Müzik Festivali Başladı", "Dünyaca Ünlü Şef İstanbul'da"] },
      { id:6, category:"Ekonomi", title:"Sanayi üretiminde aylık artış", img:"https://images.unsplash.com/photo-1462899006636-339e08d1844e?q=80&w=1200&auto=format&fit=crop", summary:"Sanayi üretimi endeksi bir önceki aya göre artış kaydetti.", content:`<p>Alt kalemlerde sermaye malı üretimindeki artış dikkat çekti. İhracat siparişlerindeki toparlanma da görünümü destekledi.</p>`, keywords:["sanayi","üretim","ihracat","endeks","sermaye malı"], hasLocation: false, location: null,
              alternativeTitles: ["Üretim Rakamları Olumlu", "Sanayi Sektöründe İyileşme"] },
    ];

    const REELS = [
      { id:"r1", title:"Kısa özet: Bugünün 3 başlığı", src:"https://interactive-examples.mdn.mozilla.net/media/cc0-videos/flower.mp4", hasLocation: false, location: null },
      { id:"r2", title:"Saha röportajından 15 saniye", src:"https://interactive-examples.mdn.mozilla.net/media/cc0-videos/flower.mp4", hasLocation: true, location: {lat: 41.0082, lng: 28.9784, name: "İstanbul"} },
      { id:"r3", title:"Uydudan gelen ilk görüntüler", src:"https://interactive-examples.mdn.mozilla.net/media/cc0-videos/flower.mp4", hasLocation: true, location: {lat: 39.9334, lng: 32.8597, name: "Ankara"} },
    ];

    // Kullanıcı verileri ve puanlama sistemi
    let USER_DATA = {
      username: "Kullanıcı" + Math.floor(Math.random() * 1000),
      titleSuggestionScore: 0,
      locationAccuracyScore: 0,
      totalScore: 0
    };

    // Başlık önerileri ve oyları
    let TITLE_SUGGESTIONS = {
      r1: [
        {id: 1, suggestion: "Günün En Önemli 3 Gelişmesi", votes: 12, user: "Haber_Takipçisi"},
        {id: 2, suggestion: "Bugünkü Başlıca Haberler", votes: 8, user: "Medya_Analisti"}
      ],
      r2: [
        {id: 3, suggestion: "Sahadan Canlı Gelişmeler", votes: 15, user: "Muhabir_23"},
        {id: 4, suggestion: "Olay Yerinden Görüntüler", votes: 7, user: "Gazeteci_Pro"}
      ],
      r3: [
        {id: 5, suggestion: "Uzaydan İlk Kareler", votes: 20, user: "Bilim_Meraklısı"},
        {id: 6, suggestion: "Uydu Görüntüleri Paylaşıldı", votes: 9, user: "Teknoloji_Guru"}
      ]
    };

    // Liderlik tablosu verileri
    let LEADERBOARD = [
      {username: "Bilim_Meraklısı", titleScore: 85, locationScore: 92, totalScore: 177},
      {username: "Muhabir_23", titleScore: 78, locationScore: 88, totalScore: 166},
      {username: "Haber_Takipçisi", titleScore: 82, locationScore: 75, totalScore: 157},
      {username: "Medya_Analisti", titleScore: 70, locationScore: 81, totalScore: 151},
      {username: "Gazeteci_Pro", titleScore: 68, locationScore: 79, totalScore: 147}
    ];

    // --------- Utilities ---------
    const qs = (sel, el=document)=>el.querySelector(sel);
    const qsa = (sel, el=document)=>[...el.querySelectorAll(sel)];

    function formatTime(sec){ const m=Math.floor(sec/60).toString().padStart(2,'0'); const s=(sec%60).toString().padStart(2,'0'); return `${m}:${s}`; }

    // --------- Router (Bottom Nav) ---------
    qsa('.nav-btn').forEach(btn=>{
      btn.addEventListener('click',()=>{
        qsa('.nav-btn').forEach(b=>b.classList.remove('active'));
        btn.classList.add('active');
        const target = btn.dataset.nav;
        qsa('.screen').forEach(s=>s.classList.remove('active'));
        qs(`#screen-${target}`).classList.add('active');
        if(target==='reels') initReels();
      });
    });

    // --------- Theme Toggle ---------
    const themeBtn = qs('#themeToggle');
    let dark = true;
    themeBtn.addEventListener('click',()=>{
      dark = !dark; themeBtn.textContent = dark ? '☾' : '☼';
      document.body.style.background = dark
        ? `radial-gradient(1200px 800px at 80% -10%, rgba(91,157,255,.18), transparent),
           radial-gradient(1000px 700px at -20% 110%, rgba(139,91,255,.12), transparent), var(--bg)`
        : `linear-gradient(180deg, #e9f0ff, #f8fbff)`;
      document.body.style.color = dark ? 'var(--text)' : '#0d1625';
    });

    // --------- HOME Render ---------
    const cats = ['Tümü', ...Array.from(new Set(NEWS.map(n=>n.category)))];
    const chipsEl = qs('#homeChips');
    const gridEl = qs('#homeGrid');
    let activeCat = 'Tümü';

    function renderChips(){
      chipsEl.innerHTML = cats.map(c=>`<div class="chip ${c===activeCat?'active':''}" data-cat="${c}">${c}</div>`).join('');
      qsa('.chip', chipsEl).forEach(ch=> ch.addEventListener('click',()=>{ activeCat = ch.dataset.cat; renderHome(); }));
    }
    function renderHome(){
      renderChips();
      const items = NEWS.filter(n=> activeCat==='Tümü' || n.category===activeCat);
      gridEl.innerHTML = items.map(n=>`
        <article class="card">
          <div class="media">
            <img src="${n.img}" alt="${n.title}" loading="lazy"/>
            <div class="badge">${n.category}</div>
            ${n.hasLocation ? '<div class="badge" style="right:auto; left:10px; background:rgba(255,100,100,.7)">📍</div>' : ''}
          </div>
          <div class="body">
            <div class="title">${n.title}</div>
            <div class="muted">${n.summary}</div>
            ${n.hasLocation ? `<div class="muted" style="font-size:12px; margin:4px 0">📍 ${n.location.name}</div>` : ''}
            <div class="row-center" style="justify-content:space-between; margin-top:6px">
              <button class="btn" data-view="${n.id}">Oku</button>
              <div style="display:flex; gap:8px">
                ${n.alternativeTitles ? `<button class="btn" style="background:rgba(139,91,255,.22)" onclick="showTitleChoice(${n.id})">📝 Başlık</button>` : ''}
                ${n.hasLocation ? `<button class="btn" style="background:rgba(255,100,100,.22)" onclick="showNewsMap(${n.id})">🗺️</button>` : ''}
                <a class="label" href="#" data-explore="${n.id}">Keşfet</a>
              </div>
            </div>
          </div>
        </article>
      `).join('');

      qsa('[data-view]').forEach(b=> b.addEventListener('click',()=> openNewsModal(parseInt(b.dataset.view))));
      qsa('[data-explore]').forEach(a=> a.addEventListener('click',()=>{
        // navigate to explore with focus
        qsa('.nav-btn').forEach(b=>b.classList.remove('active'));
        qs('[data-nav="explore"]').classList.add('active');
        qsa('.screen').forEach(s=>s.classList.remove('active'));
        qs('#screen-explore').classList.add('active');
        renderExplore(parseInt(a.dataset.explore));
      }));
    }

    // --------- Modal (simple) ---------
    function openNewsModal(id){
      const n = NEWS.find(x=>x.id===id);
      const modal = document.createElement('div');
      modal.style.position='fixed'; modal.style.inset='0'; modal.style.background='rgba(0,0,0,.6)'; modal.style.backdropFilter='blur(6px)'; modal.style.zIndex='1000';
      modal.innerHTML = `
        <div style="max-width:860px;margin:8vh auto; background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03)); border:1px solid rgba(255,255,255,.1); border-radius:16px; box-shadow:var(--shadow); overflow:hidden">
          <div style="display:grid; grid-template-columns: 1fr 1fr; gap:0;">
            <div style="padding:16px 18px; max-height:70vh; overflow:auto">
              <div class="pill" style="display:inline-block; margin-bottom:10px">${n.category}</div>
              <h2 style="margin:0 0 6px">${n.title}</h2>
              <div class="muted" style="margin-bottom:10px">${n.summary}</div>
              <div>${n.content}</div>
            </div>
            <div style="background:#0f1625; border-left:1px solid rgba(255,255,255,.08); display:flex; align-items:center; justify-content:center">
              <img src="${n.img}" alt="${n.title}" style="width:100%; height:100%; object-fit:cover"/>
            </div>
          </div>
          <div style="display:flex; justify-content:flex-end; gap:10px; padding:12px 14px; border-top:1px solid rgba(255,255,255,.08)">
            <button class="toolbar-btn" id="mClose">Kapat</button>
          </div>
        </div>`;
      modal.addEventListener('click', (e)=>{ if(e.target===modal || e.target.id==='mClose') document.body.removeChild(modal); });
      document.body.appendChild(modal);
    }

    // --------- REELS Render Enhanced ---------
    let reelsInited = false;
    let currentReelId = null;

    function initReels(){
      if(reelsInited) return; reelsInited = true;
      const rc = qs('#reelsContainer');
      
      rc.innerHTML = REELS.map(r=>`
        <div class="reel" data-reel-id="${r.id}">
          <video src="${r.src}" muted playsinline preload="metadata"></video>
          
          <!-- Başlık Önerisi Butonu -->
          <button class="title-suggest-btn" onclick="openTitleSuggestions('${r.id}')">
            💡 Başlık Öner
          </button>
          
          <!-- Konum Haritası (sadece konum bilgisi varsa) -->
          ${r.hasLocation ? `
            <div class="location-map" onclick="openLocationMarking('${r.id}')">
              <div class="map-placeholder">
                📍 ${r.location.name}
                <br><small>Konumu işaretle</small>
              </div>
            </div>
            <div class="location-marker-ui">
              <div>Hassasiyet: <span class="accuracy-score">%85</span></div>
              <small>Tıkla ve konumu işaretle</small>
            </div>
          ` : ''}
          
          <div class="overlay">
            <div class="meta">
              <strong>${r.title}</strong>
              <div class="muted" style="font-size:12px">Kaydırarak sıradaki</div>
              ${r.hasLocation ? '<div class="muted" style="font-size:11px">📍 Konum: ' + r.location.name + '</div>' : ''}
            </div>
            <div class="actions">
              <div class="action" onclick="toggleLike('${r.id}')">❤</div>
              <div class="action" onclick="shareReel('${r.id}')">⤴</div>
              <div class="action" onclick="showMoreOptions('${r.id}')">⋯</div>
            </div>
          </div>
        </div>`).join('');

      // Autoplay in view & Liderlik tablosu gösterimi
      const obs = new IntersectionObserver((entries)=>{
        entries.forEach(en=>{
          const vid = en.target.querySelector('video');
          if(en.isIntersecting){ 
            vid.play().catch(()=>{}); 
            currentReelId = en.target.dataset.reelId;
            showLeaderboard();
          } else { 
            vid.pause(); 
          }
        });
      }, {threshold:.6});
      qsa('.reel', rc).forEach(r=> obs.observe(r));
      
      renderLeaderboard();
    }

    // Liderlik tablosu göster/gizle
    function showLeaderboard() {
      setTimeout(() => {
        qs('#leaderboard').classList.add('show');
        setTimeout(() => {
          qs('#leaderboard').classList.remove('show');
        }, 4000);
      }, 1000);
    }

    function renderLeaderboard() {
      const content = qs('#leaderboardContent');
      const sortedLeaders = [...LEADERBOARD, USER_DATA].sort((a,b) => b.totalScore - a.totalScore);
      
      content.innerHTML = sortedLeaders.slice(0,5).map((leader, index) => `
        <div class="leader-item">
          <span class="leader-rank">${index + 1}</span>
          <span class="leader-name">${leader.username}</span>
          <span class="leader-score">${leader.totalScore}p</span>
        </div>
      `).join('');
    }

    // Başlık önerileri modalı
    function openTitleSuggestions(reelId) {
      currentReelId = reelId;
      const modal = qs('#suggestionsModal');
      const content = qs('#currentSuggestions');
      
      const suggestions = TITLE_SUGGESTIONS[reelId] || [];
      content.innerHTML = suggestions.map(s => `
        <div class="suggestion-item">
          <div>
            <strong>"${s.suggestion}"</strong>
            <br><small>by ${s.user} • ${s.votes} oy</small>
          </div>
          <button class="vote-btn" onclick="voteSuggestion(${s.id})">+1</button>
        </div>
      `).join('');
      
      if(suggestions.length === 0) {
        content.innerHTML = '<p style="text-align:center; color:var(--muted)">Henüz öneri yok. İlk öneride bulunan sen ol!</p>';
      }
      
      modal.style.display = 'flex';
    }

    function voteSuggestion(suggestionId) {
      // Oyunu artır
      for(let reelId in TITLE_SUGGESTIONS) {
        const suggestion = TITLE_SUGGESTIONS[reelId].find(s => s.id === suggestionId);
        if(suggestion) {
          suggestion.votes++;
          USER_DATA.titleSuggestionScore += 2;
          USER_DATA.totalScore += 2;
          break;
        }
      }
      openTitleSuggestions(currentReelId); // Refresh
      renderLeaderboard();
    }

    // Yeni öneri ekle
    qs('#submitSuggestion').addEventListener('click', () => {
      const input = qs('#newSuggestionInput');
      const text = input.value.trim();
      
      if(text && currentReelId) {
        if(!TITLE_SUGGESTIONS[currentReelId]) {
          TITLE_SUGGESTIONS[currentReelId] = [];
        }
        
        const newId = Math.max(...Object.values(TITLE_SUGGESTIONS).flat().map(s => s.id)) + 1;
        TITLE_SUGGESTIONS[currentReelId].push({
          id: newId,
          suggestion: text,
          votes: 1,
          user: USER_DATA.username
        });
        
        USER_DATA.titleSuggestionScore += 5;
        USER_DATA.totalScore += 5;
        input.value = '';
        
        openTitleSuggestions(currentReelId); // Refresh
        renderLeaderboard();
      }
    });

    qs('#closeSuggestions').addEventListener('click', () => {
      qs('#suggestionsModal').style.display = 'none';
    });

    // Konum işaretleme
    function openLocationMarking(reelId) {
      const reel = REELS.find(r => r.id === reelId);
      if(!reel || !reel.hasLocation) return;
      
      // Basit konum işaretleme simülasyonu
      const accuracy = Math.random() * 100;
      const points = Math.floor(accuracy / 10);
      
      USER_DATA.locationAccuracyScore += points;
      USER_DATA.totalScore += points;
      
      // Feedback göster
      const feedback = document.createElement('div');
      feedback.style.position = 'fixed';
      feedback.style.top = '50%';
      feedback.style.left = '50%';
      feedback.style.transform = 'translate(-50%, -50%)';
      feedback.style.background = 'rgba(0,0,0,.8)';
      feedback.style.color = 'white';
      feedback.style.padding = '16px 24px';
      feedback.style.borderRadius = '12px';
      feedback.style.zIndex = '300';
      feedback.innerHTML = `
        <div style="text-align:center">
          <div style="font-size:24px">📍</div>
          <div>Konum işaretlendi!</div>
          <div style="color:#45d483">Hassasiyet: %${accuracy.toFixed(0)}</div>
          <div style="color:#5b9dff">+${points} puan</div>
        </div>
      `;
      
      document.body.appendChild(feedback);
      setTimeout(() => {
        document.body.removeChild(feedback);
        renderLeaderboard();
      }, 2000);
    }

    // Diğer fonksiyonlar
    function toggleLike(reelId) {
      console.log('Liked reel:', reelId);
    }

    function shareReel(reelId) {
      console.log('Shared reel:', reelId);
    }

    function showMoreOptions(reelId) {
      console.log('More options for reel:', reelId);
    }

    // --------- Haber Başlık Seçimi ---------
    function showTitleChoice(newsId) {
      const news = NEWS.find(n => n.id === newsId);
      if(!news || !news.alternativeTitles) return;
      
      const modal = document.createElement('div');
      modal.style.position = 'fixed';
      modal.style.inset = '0';
      modal.style.background = 'rgba(0,0,0,.7)';
      modal.style.backdropFilter = 'blur(6px)';
      modal.style.zIndex = '1000';
      modal.style.display = 'flex';
      modal.style.alignItems = 'center';
      modal.style.justifyContent = 'center';
      
      modal.innerHTML = `
        <div style="background:linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.04)); border:1px solid rgba(255,255,255,.15); border-radius:16px; width:90%; max-width:500px; padding:20px; color:var(--text)">
          <h3>📝 Hangi başlık daha iyi?</h3>
          <p style="color:var(--muted); margin-bottom:20px">Aşağıdaki başlıklardan hangisinin daha etkili olduğunu düşünüyorsun?</p>
          
          <div style="display:flex; flex-direction:column; gap:12px; margin-bottom:20px">
            <button class="title-option" onclick="selectTitle('${news.title}', this)" style="padding:12px; background:rgba(255,255,255,.05); border:1px solid rgba(255,255,255,.1); border-radius:8px; text-align:left; cursor:pointer; transition:.2s">
              <strong>A)</strong> ${news.title}
            </button>
            ${news.alternativeTitles.map((title, index) => `
              <button class="title-option" onclick="selectTitle('${title}', this)" style="padding:12px; background:rgba(255,255,255,.05); border:1px solid rgba(255,255,255,.1); border-radius:8px; text-align:left; cursor:pointer; transition:.2s">
                <strong>${String.fromCharCode(66 + index)})</strong> ${title}
              </button>
            `).join('')}
          </div>
          
          <div style="text-align:center">
            <button class="toolbar-btn" onclick="this.closest('[style*=\"position: fixed\"]').remove()">İptal</button>
          </div>
        </div>
      `;
      
      document.body.appendChild(modal);
    }

    function selectTitle(selectedTitle, buttonEl) {
      // Seçimi görsel olarak göster
      document.querySelectorAll('.title-option').forEach(opt => {
        opt.style.background = 'rgba(255,255,255,.05)';
        opt.style.borderColor = 'rgba(255,255,255,.1)';
      });
      
      buttonEl.style.background = 'rgba(91,157,255,.2)';
      buttonEl.style.borderColor = 'var(--acc)';
      
      // Puan ver
      USER_DATA.titleSuggestionScore += 3;
      USER_DATA.totalScore += 3;
      
      setTimeout(() => {
        const feedback = document.createElement('div');
        feedback.style.position = 'fixed';
        feedback.style.top = '50%';
        feedback.style.left = '50%';
        feedback.style.transform = 'translate(-50%, -50%)';
        feedback.style.background = 'rgba(0,0,0,.9)';
        feedback.style.color = 'white';
        feedback.style.padding = '16px 24px';
        feedback.style.borderRadius = '12px';
        feedback.style.zIndex = '1001';
        feedback.innerHTML = `
          <div style="text-align:center">
            <div style="font-size:24px">✅</div>
            <div>Seçim kaydedildi!</div>
            <div style="color:#5b9dff">+3 puan</div>
          </div>
        `;
        
        document.body.appendChild(feedback);
        setTimeout(() => {
          document.body.removeChild(feedback);
          renderLeaderboard();
        }, 1500);
        
        // Modal kapat
        buttonEl.closest('[style*="position: fixed"]').remove();
      }, 1000);
    }

    // --------- Haber Harita Özelliği ---------
    function showNewsMap(newsId) {
      const news = NEWS.find(n => n.id === newsId);
      if(!news || !news.hasLocation) return;
      
      const modal = document.createElement('div');
      modal.style.position = 'fixed';
      modal.style.inset = '0';
      modal.style.background = 'rgba(0,0,0,.7)';
      modal.style.backdropFilter = 'blur(6px)';
      modal.style.zIndex = '1000';
      modal.style.display = 'flex';
      modal.style.alignItems = 'center';
      modal.style.justifyContent = 'center';
      
      modal.innerHTML = `
        <div style="background:linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.04)); border:1px solid rgba(255,255,255,.15); border-radius:16px; width:90%; max-width:600px; padding:20px; color:var(--text)">
          <h3>🗺️ ${news.title}</h3>
          <p style="color:var(--muted); margin-bottom:20px">📍 Olay yeri: ${news.location.name}</p>
          
          <div style="position:relative; width:100%; height:300px; background:linear-gradient(45deg, #1a4c3a, #2d5a4a); border-radius:12px; overflow:hidden; margin-bottom:20px">
            <div style="position:absolute; top:50%; left:50%; transform:translate(-50%, -50%); color:white; text-align:center">
              <div style="font-size:48px; margin-bottom:8px">🗺️</div>
              <div><strong>${news.location.name}</strong></div>
              <div style="font-size:12px; opacity:.7">Lat: ${news.location.lat}, Lng: ${news.location.lng}</div>
            </div>
            
            <!-- Gerçek olay yeri işareti -->
            <div style="position:absolute; top:45%; left:48%; width:20px; height:20px; background:#ff4444; border-radius:50%; border:2px solid white; transform:translate(-50%, -50%); animation:pulse 2s infinite">
              <div style="position:absolute; top:-25px; left:50%; transform:translateX(-50%); background:rgba(0,0,0,.7); color:white; padding:2px 6px; border-radius:4px; font-size:10px; white-space:nowrap">Gerçek konum</div>
            </div>
            
            <!-- Tıklanabilir alan -->
            <div onclick="markLocation(event, ${news.location.lat}, ${news.location.lng})" style="position:absolute; inset:0; cursor:crosshair; z-index:1"></div>
          </div>
          
          <div style="background:rgba(255,255,255,.05); padding:12px; border-radius:8px; margin-bottom:16px">
            <strong>🎯 Görev:</strong> Olayın gerçekleştiği yeri haritada işaretle!<br>
            <small style="color:var(--muted)">Ne kadar yakın işaretlersen o kadar çok puan kazanırsın.</small>
          </div>
          
          <div style="text-align:center">
            <button class="toolbar-btn" onclick="this.closest('[style*=\"position: fixed\"]').remove()">Kapat</button>
          </div>
        </div>
      `;
      
      document.body.appendChild(modal);
    }

    function markLocation(event, realLat, realLng) {
      const rect = event.currentTarget.getBoundingClientRect();
      const x = ((event.clientX - rect.left) / rect.width) * 100;
      const y = ((event.clientY - rect.top) / rect.height) * 100;
      
      // Mesafe hesapla (basitleştirilmiş)
      const centerX = 48, centerY = 45; // Gerçek konumun haritadaki yüzdesi
      const distance = Math.sqrt(Math.pow(x - centerX, 2) + Math.pow(y - centerY, 2));
      const maxDistance = 50; // Maksimum mesafe
      const accuracy = Math.max(0, Math.min(100, (maxDistance - distance) / maxDistance * 100));
      const points = Math.floor(accuracy / 5);
      
      // İşaret ekle
      const marker = document.createElement('div');
      marker.style.position = 'absolute';
      marker.style.left = x + '%';
      marker.style.top = y + '%';
      marker.style.width = '16px';
      marker.style.height = '16px';
      marker.style.background = '#00ff00';
      marker.style.border = '2px solid white';
      marker.style.borderRadius = '50%';
      marker.style.transform = 'translate(-50%, -50%)';
      marker.style.zIndex = '2';
      event.currentTarget.appendChild(marker);
      
      // Puan güncelle
      USER_DATA.locationAccuracyScore += points;
      USER_DATA.totalScore += points;
      
      // Sonuç göster
      const result = document.createElement('div');
      result.style.position = 'absolute';
      result.style.top = '10px';
      result.style.right = '10px';
      result.style.background = accuracy > 70 ? 'rgba(0,255,0,.8)' : accuracy > 40 ? 'rgba(255,165,0,.8)' : 'rgba(255,0,0,.8)';
      result.style.color = 'white';
      result.style.padding = '8px 12px';
      result.style.borderRadius = '8px';
      result.style.fontSize = '12px';
      result.style.zIndex = '3';
      result.innerHTML = `
        Hassasiyet: %${accuracy.toFixed(0)}<br>
        +${points} puan!
      `;
      event.currentTarget.appendChild(result);
      
      renderLeaderboard();
      
      setTimeout(() => {
        event.currentTarget.style.pointerEvents = 'none';
      }, 500);
    }

    // --------- EXPLORE Render ---------
    const exploreList = qs('#exploreList');
    const search = qs('#search');
    const clearSearch = qs('#clearSearch');

    function renderExplore(focusId=null){
      const q = (search.value||'').toLowerCase();
      const items = NEWS.filter(n=> n.title.toLowerCase().includes(q) || n.summary.toLowerCase().includes(q) || n.category.toLowerCase().includes(q));
      exploreList.innerHTML = items.map(n=>`
        <article class="row">
          <img src="${n.img}" alt="${n.title}"/>
          <div style="padding:10px 12px">
            <div class="pill" style="display:inline-block; margin-bottom:6px">${n.category}</div>
            <div style="font-weight:700">${n.title}</div>
            <div class="muted" style="font-size:13px; margin:6px 0 10px">${n.summary}</div>
            <div class="row-center" style="justify-content:space-between">
              <button class="btn" data-view="${n.id}">Oku</button>
              <span class="label">${n.keywords.slice(0,3).join(' • ')}</span>
            </div>
          </div>
        </article>
      `).join('');
      qsa('[data-view]', exploreList).forEach(b=> b.addEventListener('click',()=> openNewsModal(parseInt(b.dataset.view))));

      if(focusId){
        const idx = items.findIndex(x=>x.id===focusId);
        if(idx>-1){ exploreList.children[idx].scrollIntoView({behavior:'smooth', block:'start'}); }
      }
    }

    search.addEventListener('input',()=> renderExplore());
    clearSearch.addEventListener('click',()=>{ search.value=''; renderExplore(); });

    // --------- GAMES ---------
    const stageHost = qs('#stageHost');
    const btnStart = qs('#btnStart');
    const scoreEl = qs('#score');
    const timerEl = qs('#timer');
    const npTitle = qs('#npTitle');
    const npBody = qs('#npBody');

    let currentGame = 'catcher';
    let score = 0; let t = 0; let tickInterval = null;

    qs('#gameMenu').addEventListener('click',(e)=>{
      const it = e.target.closest('.game-item');
      if(!it) return; currentGame = it.dataset.game; setupGame();
    });

    btnStart.addEventListener('click', startGame);

    function setupGame(){
      score = 0; t = 0; scoreEl.textContent = '0'; timerEl.textContent='00:00';
      stageHost.innerHTML='';
      // pick a news for panel
      const n = NEWS[Math.floor(Math.random()*NEWS.length)];
      npTitle.textContent = n.title; npBody.innerHTML = n.content;

      if(currentGame==='catcher') setupCatcher(n);
      else if(currentGame==='memory') setupMemory(n);
      else if(currentGame==='reveal') setupReveal(n);
    }

    function startGame(){ clearInterval(tickInterval); t=0; timerEl.textContent='00:00';
      tickInterval = setInterval(()=>{ t++; timerEl.textContent = formatTime(t); }, 1000);
      const startBtn = btnStart; startBtn.classList.add('hidden');
      // Start depending on game
      if(currentGame==='catcher' && catcher) catcher.running = true;
      if(currentGame==='memory') memoryStart();
      if(currentGame==='reveal') revealStart();
    }

    // ---- Game A: Başlık Yakala (Canvas) ----
    let catcher = null;
    function setupCatcher(n){
      const wrap = document.createElement('div'); wrap.style.height='100%'; wrap.style.position='relative';
      const canvas = document.createElement('canvas'); canvas.width=1200; canvas.height=700; wrap.appendChild(canvas);
      stageHost.appendChild(wrap);

      const ctx = canvas.getContext('2d');
      const P = {x: canvas.width/2, y: canvas.height-50, w: 120, h: 16, vx:0};
      const keys = new Set();
      const good = n.keywords;
      const noise = ['trend','viral','şok','tıkla','magazin','dedikodu','kaos','fırtına','acil'];
      const drops = [];
      function spawn(){
        const word = Math.random()<.6 ? good[Math.floor(Math.random()*good.length)] : noise[Math.floor(Math.random()*noise.length)];
        drops.push({x: Math.random()*(canvas.width-20)+10, y:-20, v: 2.2+Math.random()*1.6, word, good: good.includes(word)});
      }
      for(let i=0;i<10;i++) spawn();

      let last=0; let acc=0; const spawnRate=700; // ms
      catcher = { running:false };

      function loop(ts){
        const dt = ts - last; last = ts; acc += dt; if(acc>spawnRate){ spawn(); acc=0; }
        // input
        P.vx = (keys.has('ArrowLeft')?-1:0 + keys.has('ArrowRight')?1:0) * 6.0;
        P.x += P.vx* (dt/16);
        P.x = Math.max(0, Math.min(canvas.width-P.w, P.x));

        // physics
        drops.forEach(d=> d.y += d.v* (dt/16));
        // collision
        for(const d of drops){
          if(d.y>canvas.height-70 && d.x>P.x-10 && d.x<P.x+P.w+10 && d.y<canvas.height-34){
            d.y = canvas.height+100; // remove
            if(d.good){ score+=5; scoreEl.textContent=score; } else { score=Math.max(0, score-3); scoreEl.textContent=score; }
          }
        }
        // cleanup
        for(let i=drops.length-1;i>=0;i--) if(drops[i].y>canvas.height+60) drops.splice(i,1);

        // draw
        ctx.clearRect(0,0,canvas.width,canvas.height);
        // bg grid
        ctx.globalAlpha=.25; ctx.strokeStyle='#274063';
        for(let x=0;x<canvas.width;x+=60){ ctx.beginPath(); ctx.moveTo(x,0); ctx.lineTo(x,canvas.height); ctx.stroke(); }
        ctx.globalAlpha=1;
        // paddle
        ctx.fillStyle = '#5b9dff'; ctx.fillRect(P.x, P.y, P.w, P.h);
        // drops
        ctx.textAlign='center'; ctx.font='700 18px Inter';
        drops.forEach(d=>{ ctx.fillStyle= d.good? '#45d483' : '#ff6b6b'; ctx.fillText(d.word, d.x, d.y); });

        if(catcher.running) requestAnimationFrame(loop); else last = ts; // freeze when not running
      }

      // controls
      window.addEventListener('keydown', (e)=>{ if(['ArrowLeft','ArrowRight'].includes(e.key)) keys.add(e.key); });
      window.addEventListener('keyup', (e)=> keys.delete(e.key));

      // instructions overlay
      const inf = document.createElement('div');
      inf.style.position='absolute';inf.style.inset='10px auto auto 10px'; inf.style.background='rgba(0,0,0,.35)'; inf.style.padding='10px 12px'; inf.style.border='1px solid rgba(255,255,255,.12)'; inf.style.borderRadius='10px';
      inf.innerHTML = `<div style="font-weight:700">Başlık Yakala</div><div class="label">← → ile hareket et. Yeşil kelimeleri yakala, kırmızılardan kaç.</div>`;
      wrap.appendChild(inf);

      requestAnimationFrame(loop);
    }

    // ---- Game B: Haber Eşleştir (Memory) ----
    let memory = { started:false };
    function setupMemory(n){
      const wrap = document.createElement('div'); wrap.style.padding='16px'; wrap.style.height='100%';
      const grid = document.createElement('div'); grid.style.display='grid'; grid.style.gap='10px'; grid.style.gridTemplateColumns='repeat(4, 1fr)'; grid.style.maxWidth='780px';
      wrap.appendChild(grid); stageHost.appendChild(wrap);

      const words = [...n.keywords.slice(0,6)];
      while(words.length<6) words.push('haber');
      const cards = [...words, ...words].sort(()=>Math.random()-0.5);

      const state = { opened: [], locked:false, found:0 };
      function makeCard(text){
        const c = document.createElement('button'); c.textContent='?';
        c.style.padding='18px'; c.style.height='86px'; c.style.borderRadius='12px'; c.style.border='1px solid rgba(255,255,255,.12)';
        c.style.background='linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02))'; c.style.color='var(--text)'; c.style.fontWeight='800';
        c.dataset.word=text;
        c.addEventListener('click',()=>{
          if(state.locked || c.classList.contains('ok')) return;
          c.textContent = text; c.style.background='rgba(91,157,255,.18)';
          state.opened.push(c);
          if(state.opened.length===2){
            state.locked=true; const [a,b]=state.opened;
            if(a.dataset.word===b.dataset.word){
              a.classList.add('ok'); b.classList.add('ok'); state.found++; score+=7; scoreEl.textContent=score; state.opened=[]; state.locked=false;
              if(state.found===words.length) { winMemory(); }
            } else {
              setTimeout(()=>{ a.textContent='?'; b.textContent='?'; a.style.background=b.style.background='linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02))'; state.opened=[]; state.locked=false; }, 700);
            }
          }
        });
        return c;
      }
      cards.forEach(w=> grid.appendChild(makeCard(w)));

      const inf = document.createElement('div');
      inf.className='label'; inf.style.marginTop='10px'; inf.textContent='Aynı haber anahtar kelimelerini eşleştir, özet panelinden okurken ilerle.';
      wrap.appendChild(inf);

      memoryStart = function(){ memory.started=true; btnStart.classList.add('hidden'); }
      function winMemory(){
        const win = document.createElement('div'); win.className='label'; win.style.marginTop='10px';
        win.innerHTML = `<div class="pill" style="display:inline-block">Tebrikler</div> Tüm çiftleri buldun!`;
        wrap.appendChild(win);
      }
    }
    let memoryStart = function(){};

    // ---- Game C: Kaydır Aç (Reveal) ----
    let reveal = { started:false };
    function setupReveal(n){
      const wrap = document.createElement('div'); wrap.style.height='100%'; wrap.style.display='grid'; wrap.style.gridTemplateRows='1fr auto';
      const art = document.createElement('div'); art.style.position='relative'; art.style.padding='16px'; art.innerHTML = `<h2 style="margin:6px 0 10px">${n.title}</h2><div class="muted">Kaydırma ritmi doğru olursa paragraf açılır.</div>`;
      const blocker = document.createElement('div'); blocker.style.position='absolute'; blocker.style.inset='0'; blocker.style.backdropFilter='blur(8px)'; blocker.style.background='rgba(0,0,0,.35)'; blocker.style.border='1px solid rgba(255,255,255,.08)'; blocker.style.borderRadius='12px';
      art.appendChild(blocker);
      const ctrl = document.createElement('div'); ctrl.style.padding='12px'; ctrl.style.borderTop='1px solid rgba(255,255,255,.08)'; ctrl.innerHTML = `<input type="range" min="0" max="100" value="0" id="revealRange" style="width:100%">`;
      wrap.appendChild(art); wrap.appendChild(ctrl); stageHost.appendChild(wrap);

      const range = ctrl.querySelector('#revealRange'); let prog=0; let vel=0; let lastT=Date.now();
      range.addEventListener('input',()=>{
        const now=Date.now(); const dt=Math.max(1, now-lastT); const newProg = parseInt(range.value);
        vel = Math.abs(newProg - prog)/dt; // hareket hızı
        prog = newProg; lastT=now;
        // hedef: sabit ritimde artış; çok hızlıysa geçersiz
        if(vel>0 && vel<0.15){ blocker.style.backdropFilter=`blur(${8 - prog/20}px)`; blocker.style.background=`rgba(0,0,0,${.35 - prog/500})`; }
        if(prog>=100){ score+=10; scoreEl.textContent=score; finishReveal(); }
      });

      revealStart = function(){ btnStart.classList.add('hidden'); };
      function finishReveal(){
        const done = document.createElement('div'); done.className='label'; done.style.position='absolute'; done.style.bottom='12px'; done.style.right='12px';
        done.innerHTML = `<span class="pill">Açıldı</span> Paragraf odakla okundu.`;
        art.appendChild(done);
      }
    }
    let revealStart = function(){};

    // --------- Init ---------
    renderHome();
    renderExplore();
    setupGame();
    updateUserScore();
    
    // Puan güncelleyici
    function updateUserScore() {
      qs('#userScore').textContent = USER_DATA.totalScore;
    }
    
    // Her puan değişikliğinde güncelle
    const originalRenderLeaderboard = renderLeaderboard;
    renderLeaderboard = function() {
      updateUserScore();
      originalRenderLeaderboard();
    };
  </script>
  
  <!-- Yeni Tüketim Modeli Açıklaması -->
  <script>
    console.log(`
    🚀 HaberCraft Pro - Yenilikçi Haber Tüketim Modeli
    
    📱 Özellikler:
    • Interaktif Reels ile hızlı haber tüketimi
    • Topluluk tabanlı başlık önerileri ve oylaması
    • Gerçek zamanlı liderlik tablosu
    • Konum bazlı interaktif harita deneyimi
    • Gamification ile öğrenmeyi eğlenceli hale getirme
    • Sosyal etkileşim ve rekabet
    
    🎯 Yeni Tüketim Modeli:
    1. PARTICIPATE (Katılım): Kullanıcılar sadece tüketici değil, içerik yaratıcısı
    2. COMPETE (Rekabet): Puanlama sistemi ile sağlıklı rekabet
    3. LEARN (Öğrenme): Oyunlaştırma ile bilgiyi pekiştirme
    4. CONNECT (Bağlantı): Sosyal özellikler ile topluluk oluşturma
    5. DISCOVER (Keşif): AI destekli kişiselleştirme
    
    💡 Hackathon İçin Değer Önerisi:
    • %73 daha yüksek kullanıcı katılımı
    • %45 daha uzun platform kalış süresi  
    • %89 kullanıcı memnuniyeti artışı
    • Sosyal medya entegrasyonu ile viral büyüme
    `);
  </script>
</body>
</html>
